
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BUGminerbot - Watch2Earn</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <style>
    body{margin:0;font-family:Arial;background:#111;color:#fff;padding:1rem;display:flex;flex-direction:column;align-items:center}
    .banner{background:#00ff88;color:#000;padding:1rem;border-radius:12px;font-weight:bold;margin-bottom:1rem;text-align:center;width:95%}
    .bot-banner{background:#ff6b35;color:#fff;padding:1rem;border-radius:12px;font-weight:bold;margin-bottom:1rem;text-align:center;width:95%}
    .ref-link-box{background:rgba(0,255,136,0.2);border:2px solid #00ff88;padding:1rem;border-radius:12px;margin:1rem 0;width:95%;text-align:center}
    .ref-link{color:#00ff88;font-weight:bold;font-size:1.1rem;cursor:pointer}
    .video{background:rgba(255,255,255,0.1);border-radius:12px;padding:1rem;margin:1rem 0;width:95%}
    .btn{background:#00ff88;color:#000;border:none;padding:14px;border-radius:10px;margin:10px auto;width:90%;font-weight:bold;font-size:1.1rem}
    .btn:disabled{background:#555}
    .count{color:#00ff88;text-align:center}
    .locked{color:#ff5555;font-weight:bold}
    .ref{color:#ffcc00;font-weight:bold;font-size:1.2rem}
  </style>
</head>

<body>

<a href="https://t.me/BUGminerbot" class="bot-banner" target="_blank">ðŸš€ Start Bot Here @BUGminerbot</a>
<a href="https://t.me/+bKHfwO7GUUwxZTA1" class="banner" target="_blank">Join Our Official Telegram Channel</a>

<div id="userInfo"></div>
<div id="refStats" class="ref"></div>

<div id="refLinkBox" class="ref-link-box">
  <div>Your Unique Referral Link:</div>
  <div id="refLink" class="ref-link"></div>
  <div>Share â†’ Friends Join â†’ Unlock Post 4 & 5!</div>
</div>

<div id="videos-container"></div>

<script src="//libtl.com/sdk.js" data-zone="9903296" data-sdk="show_9903296"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAghzdqVABzhmrGR3W6XiXsUMCH0Awuhcw",
    authDomain: "watch2earn-d0126.firebaseapp.com",
    projectId: "watch2earn-d0126"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  firebase.auth().signInAnonymously();

  const BOT = "BUGminerbot";
  const REQUIRED_REFERRALS = 5;

  const driveLinks = {
    1:"https://drive.google.com/uc?export=download&id=190F4MriUa_w4Rf8o07eS8U4Ncvck2K51",
    2:"https://drive.google.com/uc?export=download&id=1kJ4sjDWf61WplqPur2I3R48bTjkRsnN1",
    3:"https://drive.google.com/uc?export=download&id=1ZCgEuAEq55aSAKKEVCKnskWVWP29eol_",
    4:"https://drive.google.com/uc?export=download&id=1kPl_yU36ATVQQP8GkvziWlJwZMddy05J",
    5:"https://drive.google.com/uc?export=download&id=1IxFE1NezW86UHPFs5IxL-YVT5nDUf_qY"
  };

  const tg = window.Telegram.WebApp;
  tg.ready();

  const user = tg.initDataUnsafe.user;
  const startParam = tg.initDataUnsafe.start_param || "";
  const userId = user.id.toString();
  const userRef = db.collection("users").doc(userId);

  document.getElementById("userInfo").innerText = `Hi ${user.first_name}!`;

  async function init() {
    const snap = await userRef.get();
    if (!snap.exists) await userRef.set({ referrals: [] });

    if (startParam.startsWith("ref_")) {
      const refId = startParam.replace("ref_","");
      if (refId !== userId) {
        await db.collection("users").doc(refId).set({
          referrals: firebase.firestore.FieldValue.arrayUnion(userId)
        },{merge:true});
      }
    }

    const data = (await userRef.get()).data();
    const refCount = data.referrals.length;

    document.getElementById("refStats").innerText =
      `Referrals: (${refCount}/${REQUIRED_REFERRALS})`;

    const refLink = `https://t.me/${BOT}?startapp=ref_${userId}`;
    document.getElementById("refLink").innerText = refLink;
    document.getElementById("refLink").onclick = () => {
      navigator.clipboard.writeText(refLink);
      tg.showAlert("Referral Link Copied!");
    };

    for(let i=1;i<=5;i++){
      const active = i<=3 || refCount>=REQUIRED_REFERRALS;
      createPost(i,active);
    }
  }

  function createPost(id,active){
    const d=document.createElement("div");
    d.className="video";

    if(!active){
      d.innerHTML=`<h3>Post ${id} <span class="locked">(Locked)</span></h3>
      <button class="btn" disabled>Need Referrals</button>`;
    }else{
      d.innerHTML=`<h3>Post ${id}</h3>
      <button class="btn">Watch 1 Ad & Get Link</button>
      <div class="count">Ready to Unlock</div>`;

      d.querySelector(".btn").onclick=async()=>{
        await show_9903296("pop");
        window.open(driveLinks[id],"_blank");
      };
    }
    document.getElementById("videos-container").appendChild(d);
  }

  init();
</script>
</body>
</html>
